<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BatCards</title>

    <style>
        body {
            background-color: #101010;
            font-family: monospace;
        }

        #containingBox {
            display: flex;
            justify-content: space-between;
            width: 100vw;
        }

        .deck {
            width: 15vw;
            height: 40vh;
            display: flex;
            justify-content: space-between;
            flex-direction: column;
            border: 5px solid white;
            background-color: #2f2f2f;
            padding: 10px;
        }

        .bottomRight {
            text-align: right;
        }

        h1 {
            text-align: center;
        }

        h2 {
            margin-top: 0px;
            font-size: 4em;
        }

        button {
            width: 20vw;
            font-size: xx-large;
            background-color: #101010;
            border: none;
        }

        h3 {
            text-align: center;
        }

        #bigBox {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    </style>
</head>

<body>
    <h1 style="color: white;">BatCards</h1>
    <h3 id="timer" style="color: white; display: none;">Time: 0.000s</h3>
    <div id="bigBox">
        <div style="height: 10vh; display: none;" class="deck next" id="playingCards">
            <h2 class="cardTitleAhead"></h2>
        </div>
        <div id="containingBox">
            <button onclick="addCards(true)">⬅️</button>
            <div class="deck left" id="playingCards">
                <h2 class="cardTitleLeft"></h2>
                <h2 class="cardTitleLeft bottomRight"></h2>
            </div>
            <div class="deck current" id="playingCards">
                <h2 class="cardTitle"></h2>
                <h2 class="cardTitle bottomRight"></h2>
            </div>
            <div class="deck right" id="playingCards">
                <h2 class="cardTitleRight"></h2>
                <h2 class="cardTitleRight bottomRight"></h2>
            </div>
            <button onclick="addCards(false)">➡️</button>
        </div>
    </div>

</body>

</html>

<script>
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;

        // While there remain elements to shuffle.
        while (currentIndex > 0) {

            // Pick a remaining element.
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;

            // And swap it with the current element.
            [array[currentIndex], array[randomIndex]] = [
                array[randomIndex], array[currentIndex]];
        }

        return array;
    }

    const suits = ["♣️", "♠️", "♦️", "♥️"
    ];
    const values = [
        "A", "2", "3", "4", "5", "6", "7", "8", "9", "0", "J", "Q", "K"
    ];

    class Card {
        constructor(suit, value) {
            this.suit = suit;
            this.value = value;
        }
    }

    const deck = new Array();
    function createDeck() {
        for (suit of suits) {
            for (value of values) {
                const card = new Card(suit, value);
                deck.push(card);
            }
        }
        shuffle(deck);
    }



    createDeck();

    let currentCard = deck.pop();
    let blackCards = new Array();
    let redCards = new Array();
    updateCardView();
    let timer;
    let errors = 0;


    // function to start the timer
    function startTimer() {
        // First check whether Web Workers are supported
        if (typeof (Worker) !== "undefined") {
            // Check whether Web Worker has been created. If not, create a new Web Worker based on the Javascript file simple-timer.js
            if (timer == null) {
                timer = new Worker("simple-timer.js");
            }
            // Update timer div with output from Web Worker
            timer.onmessage = function (event) {
                document.getElementById("timer").innerHTML = event.data;
            };
        } else {
            // Web workers are not supported by your browser
            document.getElementById("timer").innerHTML = "Sorry, your browser does not support Web Workers ...";
        }
    }

    // function to stop the timer
    function stopTimer() {
        timer.terminate();
        timer = null;
    }

    document.addEventListener('keydown', function (event) {
        if (event.keyCode == 37 || event.keyCode == 65) {
            addCards(true);
        } else if (event.keyCode == 39 || event.keyCode == 76) {
            addCards(false);
        } else if (event.keyCode == 32) {
            location.reload();
        }
    });

    function addCards(isBlack) {
        if (isBlack) {
            blackCards.push(currentCard);
        } else {
            redCards.push(currentCard);
        }
        if (deck.length == 0) {
            stopTimer();
            gameTally();
            createDeck();
            errors = 0;
            blackCards = new Array();
            redCards = new Array();
            return;
        } else {
            currentCard = deck.pop();
            updateCardView();
        }
        if (deck.length == 50) {
            startTimer();
        }
    }

    function updateCardView() {
        Array.from(document.getElementsByClassName("cardTitle")).forEach((element) => element.innerText = currentCard.value + currentCard.suit);
        const current = document.getElementsByClassName("current")[0];
        if (currentCard.suit == "♥️" || currentCard.suit == "♦️") {
            current.style.color = "Red";
        } else {
            current.style.color = "Black";
        }

        if (deck.length != 0) {
            const next = document.getElementsByClassName("next")[0];
            if (deck[deck.length - 1].suit == "♥️" || deck[deck.length - 1].suit == "♦️") {
                next.style.color = "Red";
            } else {
                next.style.color = "Black";
            }
            Array.from(document.getElementsByClassName("cardTitleAhead")).forEach((element) => element.innerText = deck[deck.length - 1].value + deck[deck.length - 1].suit);
        }

        if (blackCards != null && blackCards.length > 0) {
            const left = document.getElementsByClassName("left")[0];
            if (blackCards[blackCards.length - 1].suit == "♥️" || blackCards[blackCards.length - 1].suit == "♦️") {
                left.style.color = "Red";
            } else {
                left.style.color = "Black";
            }
            Array.from(document.getElementsByClassName("cardTitleLeft")).forEach((element) => element.innerText = blackCards[blackCards.length - 1].value + blackCards[blackCards.length - 1].suit);
        }

        if (redCards != null && redCards.length > 0) {
            const right = document.getElementsByClassName("right")[0];
            if (redCards[redCards.length - 1].suit == "♥️" || redCards[redCards.length - 1].suit == "♦️") {
                right.style.color = "Red";
            } else {
                right.style.color = "Black";
            }
            Array.from(document.getElementsByClassName("cardTitleRight")).forEach((element) => element.innerText = redCards[redCards.length - 1].value + redCards[redCards.length - 1].suit);
        }
    }

    function gameTally() {
        for (let i = 0; i < blackCards.length; i++) {
            if (blackCards[i].suit == "♥️" || blackCards[i].suit == "♦️") {
                errors++;
            }
        }
        for (let i = 0; i < redCards.length; i++) {
            if (redCards[i].suit == "♣️" || redCards[i].suit == "♠️") {
                errors++;
            }
        }
        alert("You did it in " + document.getElementById("timer").innerText + "\n" + "You had " + errors + " errors.");
    }

</script>